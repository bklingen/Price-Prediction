---
title: "Lasso"
author: "Thomas FitzGerald and Mei Maddox"
date: '2022-10-13'
output:
  pdf_document: default
  html_document: default
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(knitr.duplicate.label = 'allow')
knitr::opts_chunk$set(echo = TRUE, warnings = FALSE, message = FALSE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=70))
```

```{r read.previous, echo=FALSE}
source(knitr::purl("../KaggleHousePrices.Rmd", quiet = TRUE))
```

```{r libraries, include=FALSE}
library(splines)
library(glmnet)
```

```{r}
fit.all <- train %>% select(-Id) %>% 
  lm(log(SalePrice) ~ ., data=.)
```


```{r}
X <- model.matrix(fit.all)[,-1]
X.sd = scale(X)
head(X.sd)
```

```{r}
fit.lasso <- glmnet(x=X.sd, y=train$SalePrice, alpha=1)
plot(fit.lasso, xvar="lambda", label=TRUE)
```

```{r}
cross.val <- cv.glmnet(x=X.sd, y=train$SalePrice, alpha=1)
plot(cross.val)
```


```{r}
fit.lasso.opt <- glmnet(x=X, y=train$SalePrice, 
                        lambda=cross.val$lambda.min, 
                        alpha = 1, standardize = TRUE)
coef(fit.lasso.opt)
```

`predict(fit.lasso.opt, newx=test)` raises an error regarding the number of variables. This is because the fit function creates dummy variables. We must model the test set to have the same structure as the modeled training set (175 variables).

```{r}
predicted.lasso = test %>% 
  select(-Id) %>% 
  model.matrix(as.formula("~."), .) %>%
  tibble::as_tibble() %>%
  select(., -setdiff(colnames(.), colnames(X))) %>%
  as.matrix() %>%
  predict(fit.lasso.opt, newx=.)
SubmitDF = data.frame(Id=test$Id, SalePrice=predicted.lasso)
write.csv(file='../submissions/lasso1.csv', SubmitDF, row.names = FALSE)
```






